{% extends "navigation.html" %}
{% block content %}
    <style>

    </style>

    {% set foundAppointment = namespace(found=False) %}
    {% set i = namespace(number = 0) %}

    <form action="/user/{{otherUserId}}" method="POST">

        {{ dateform.hidden_tag() }}
        {{dateform.start_date.label}}
        {{ dateform.start_date() }}
        {{ dateform.submit()}}

        <table>
            <tr>
                <td>Heure</td>
                {% for day in weekdays %}
                    <td>{{day[0]}}</td>

                {% endfor %}
            </tr>

            {% for time in times %}

                <tr>

                    <td> {{time.strftime("%H:%M")}}</td>

                    {% for day in weekdays %}

                        {% if appointments == [] %}
                            <td style="background-color: rgba(0, 123, 255, 0.1);">

                                {% if (day[1].date() > current_date.date() ) or (day[1].date()==current_date.date() and time.time() >
                                current_time) %}

                                <button type="button" onclick="location.href='/appointment/{{day[1].date()}}/{{time.time()}}/{{otherUserId}}'">Make an appointment</button>
                        {% endif %}

                        </td>
                    {% else %}

                        {% for app in appointments %}

                            {% if app.time_start.date() == day[1].date() and app.time_start.time() == time.time() %}
                                {% set foundAppointment.found = True %}
                                {% if confirmations[app.id][0] ==2 %}
                                    <td style="background-color: green;">{{ app.title}} <br>
                                        Date:{{ app.time_start.day }}/{{app.time_start.month}}/{{app.time_start.year}} <br>
                                        Heure: {{app.time_start.time()}} - {{app.time_end.time()}}
                                        number: {{i.number}}
                                        bool: {{confirmations[i.number]}}
                                    </td>

                                    {% set i.number = i.number+1 %}

                                {% elif confirmations[app.id][0]==0 %}
                                    <td style="background-color:  rgba(255, 157, 0, 0.253);">{{ app.title}} <br>
                                        Date:{{ app.time_start.day }}/{{app.time_start.month}}/{{app.time_start.year}} <br>
                                        Heure: {{app.time_start.time()}} - {{app.time_end.time()}}
                                        number: {{i.number}}
                                        bool: {{confirmations[i.number]}}

                                        {% set i.number = i.number+1 %}
                                    </td>
                                {% elif confirmations[app.id][0]==1 %}
                                    <td style="background-color:  rgba(255, 0, 191, 0.253);">{{ app.title}} <br>
                                        Date:{{ app.time_start.day }}/{{app.time_start.month}}/{{app.time_start.year}} <br>
                                        Heure: {{app.time_start.time()}} - {{app.time_end.time()}}
                                        number: {{i.number}}
                                        bool: {{confirmations[i.number]}}
                                    
                                        {% set i.number = i.number+1 %}
                                    </td>

                                {% endif %}

                            {% endif %}

                        {% endfor %}

                        {% if not foundAppointment.found %}

                            <td style="background-color: rgba(0, 123, 255, 0.1);">

                                {% if (day[1].date() > current_date.date() ) or (day[1].date()==current_date.date() and time.time() > current_time) %}

                                    <button type="button" onclick="location.href='/appointment/{{day[1].date()}}/{{time.time()}}/{{otherUserId}}'">Make an appointment</button>
                                {% endif %}
                            </td>

                        {% endif %}
                        {% set foundAppointment.found=False %}

                    {% endif %}
            {% endfor %}

        </tr>
{% endfor %}

</table>
{% set i.number = 0 %}
{% endblock %}